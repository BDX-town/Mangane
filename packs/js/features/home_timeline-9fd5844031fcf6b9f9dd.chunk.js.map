{"version":3,"file":"packs/js/features/home_timeline-9fd5844031fcf6b9f9dd.chunk.js","mappings":"yOAAusBA,GAAS,QAAe,CAACC,MAAM,CAAC,GAAK,cAAc,eAAiB,UAAgBC,EAAW,OAKoyB,UAL1wB,WAAK,IAAMC,GAAK,SAAgBC,GAAS,UAAuBC,GAAS,UAAoBC,GAAQ,IAAAC,QAAO,MAAYC,GAAU,SAAe,SAAAC,GAAQ,IAAIC,EAAqB,OAAyI,KAA7E,QAApDA,EAAqBD,EAAME,UAAUC,IAAI,eAAwC,IAAvBF,OAA8B,EAAOA,EAAqBF,cAA2BK,GAAiB,SAAe,SAAAJ,GAAQ,IAAIK,EAAsB,OAA4D,QAArDA,EAAsBL,EAAME,UAAUC,IAAI,eAAyC,IAAxBE,OAA+B,EAAOA,EAAsBC,iBAAuBC,GAAU,SAAe,SAAAP,GAAO,OAAAA,EAAMQ,SAAShB,SAAaiB,GAA2B,SAAe,SAAAT,GAAO,OAAAI,EAAiBJ,EAAMU,cAAcP,IAAIC,GAAkB,QAAYO,GAAe,IAAAC,cAAY,SAAAC,GAAQlB,GAAS,QAAmB,CAACkB,MAAK,EAACC,UAAUV,OAAsB,CAACA,EAAiBT,IAAiBoB,GAAY,IAAAH,cAAY,WAAQf,EAAQmB,UAASC,cAAcpB,EAAQmB,SAASnB,EAAQmB,QAAQ,QAAQ,IAE/vDE,GAAoB,IAAAN,cAAY,WAAQb,EAAWF,EAAQmB,QAAQG,aAAY,WAAKxB,GAAS,aAAwB,KAAYoB,MAAiB,CAACpB,EAASI,EAAUgB,IAAoBK,GAAc,IAAAR,cAAY,kB,OAAA,E,OAAA,E,EAAA,kB,oiCAAA,mB,uBAAU,SAAMjB,GAAS,QAAmB,CAACkB,MAAM,KAAKC,UAAUV,M,OAAoB,OAA5E,SAAmF,CAAP,EAAOT,GAAS,QAAgBF,U,YAAtH,K,gRAAqI,CAACW,EAAiBT,IAGvD,OAHkE,IAAA0B,YAAU,WAA2B,OAAtBH,IAA4B,WAAKH,OAAkB,CAACG,EAAoBnB,EAAUgB,KAAc,IAAAM,YAAU,WAClfjB,GAAkBT,GAAS,SAAmB,CAACS,OAAuB,CAACA,EAAiBT,KAAW,IAAA0B,YAAU,YAE7GZ,GAA8BA,MAAAA,GAAwEA,EAA2Ba,YAAY3B,GAAS,WAAsBA,GAAS,QAAmB,IAAG,WAAKA,GAAS,kBAAsC,CAACS,EAAiBK,EAA2Bd,KAA8B,OAAK,KAAO,CAAC4B,MAAM7B,EAAK8B,cAAcjC,EAASC,OAAOiC,aAAY,EAAKC,YAAW,QAAO,GAAoB,OAAK,IAAc,CAACC,UAAUP,QAAe,GAAoB,OAAK,IAAS,CAACQ,UAAU,gBAAgBC,WAAWlB,EAAelB,WAAWA,EAAWqC,WAAW,QAAQC,SAAQ,EAAKC,cAA0B,OAAK,KAAM,CAACC,MAAM,QAAG,GAAoB,OAAK,KAAK,CAACC,KAAK,KAAKC,OAAO,SAASC,MAAM,eAAU,GAAoB,OAAK,IAAiB,CAACC,GAAG,0BAA0BC,eAAe,sCAAkD,OAAK,KAAK,CAACC,MAAM,QAAQH,MAAM,eAAU,GAAoB,OAAK,IAAiB,CAACC,GAAG,6BAA6BC,eAAe,iEAAiEE,OAAO,CAACjC,UAAS,MAAKX,EAAS6C,aAAyB,OAAK,KAAK,CAACF,MAAM,QAAQH,MAAM,eAAU,GAAoB,OAAK,IAAiB,CAACC,GAAG,oBAAoBC,eAAe,iEAAiEE,OAAO,CAACE,QAAoB,OAAK,KAAK,CAACC,GAAG,kBAAkBC,UAAU,+DAA0D,GAAoB,OAAK,IAAiB,CAACP,GAAG,8BAA8BC,eAAe,uBAAuBE,OAAO,CAACK,WAAWtC","sources":["webpack://mangane-fe/./app/soapbox/features/home_timeline/index.tsx"],"sourcesContent":["import _jsx from\"@babel/runtime/helpers/esm/jsx\";import React,{useCallback,useEffect,useRef}from'react';import{defineMessages,useIntl,FormattedMessage}from'react-intl';import{Link}from'react-router-dom';import{fetchRelationships}from'soapbox/actions/accounts';import{fetchSuggestionsForTimeline}from'soapbox/actions/suggestions';import{dequeueTimeline,expandHomeTimeline}from'soapbox/actions/timelines';import PullToRefresh from'soapbox/components/pull-to-refresh';import{Column,Stack,Text}from'soapbox/components/ui';import Timeline from'soapbox/features/ui/components/timeline';import{useAppSelector,useAppDispatch,useFeatures}from'soapbox/hooks';import{clearFeedAccountId}from'../../actions/timelines';const messages=defineMessages({title:{\"id\":\"column.home\",\"defaultMessage\":\"Home\"}});const timelineId='home';const HomeTimeline=()=>{const intl=useIntl();const dispatch=useAppDispatch();const features=useFeatures();const polling=useRef(null);const isPartial=useAppSelector(state=>{var _state$timelines$get;return((_state$timelines$get=state.timelines.get('home'))===null||_state$timelines$get===void 0?void 0:_state$timelines$get.isPartial)===true;});const currentAccountId=useAppSelector(state=>{var _state$timelines$get2;return(_state$timelines$get2=state.timelines.get('home'))===null||_state$timelines$get2===void 0?void 0:_state$timelines$get2.feedAccountId;});const siteTitle=useAppSelector(state=>state.instance.title);const currentAccountRelationship=useAppSelector(state=>currentAccountId?state.relationships.get(currentAccountId):null);const handleLoadMore=useCallback(maxId=>{dispatch(expandHomeTimeline({maxId,accountId:currentAccountId}));},[currentAccountId,dispatch]);const stopPolling=useCallback(()=>{if(polling.current){clearInterval(polling.current);polling.current=null;}},[]);// Mastodon generates the feed in Redis, and can return a partial timeline\n// (HTTP 206) for new users. Poll until we get a full page of results.\nconst checkIfReloadNeeded=useCallback(()=>{if(isPartial){polling.current=setInterval(()=>{dispatch(expandHomeTimeline());},3000);}else{stopPolling();}},[dispatch,isPartial,stopPolling]);const handleRefresh=useCallback(async()=>{await dispatch(expandHomeTimeline({maxId:null,accountId:currentAccountId}));return dispatch(dequeueTimeline(timelineId));},[currentAccountId,dispatch]);useEffect(()=>{checkIfReloadNeeded();return()=>{stopPolling();};},[checkIfReloadNeeded,isPartial,stopPolling]);useEffect(()=>{// Check to see if we still follow the user that is selected in the Feed Carousel.\nif(currentAccountId){dispatch(fetchRelationships([currentAccountId]));}},[currentAccountId,dispatch]);useEffect(()=>{// If we unfollowed the currently selected user from the Feed Carousel,\n// let's clear the feed filter and refetch fresh timeline data.\nif(currentAccountRelationship&&!(currentAccountRelationship!==null&&currentAccountRelationship!==void 0&&currentAccountRelationship.following)){dispatch(clearFeedAccountId());dispatch(expandHomeTimeline({},()=>{dispatch(fetchSuggestionsForTimeline());}));}},[currentAccountId,currentAccountRelationship,dispatch]);return/*#__PURE__*/_jsx(Column,{label:intl.formatMessage(messages.title),transparent:true,withHeader:false},void 0,/*#__PURE__*/_jsx(PullToRefresh,{onRefresh:handleRefresh},void 0,/*#__PURE__*/_jsx(Timeline,{scrollKey:\"home_timeline\",onLoadMore:handleLoadMore,timelineId:timelineId,divideType:\"space\",showAds:true,emptyMessage:/*#__PURE__*/_jsx(Stack,{space:1},void 0,/*#__PURE__*/_jsx(Text,{size:\"xl\",weight:\"medium\",align:\"center\"},void 0,/*#__PURE__*/_jsx(FormattedMessage,{id:\"empty_column.home.title\",defaultMessage:\"You're not following anyone yet\"})),/*#__PURE__*/_jsx(Text,{theme:\"muted\",align:\"center\"},void 0,/*#__PURE__*/_jsx(FormattedMessage,{id:\"empty_column.home.subtitle\",defaultMessage:\"{siteTitle} gets more interesting once you follow other users.\",values:{siteTitle}})),features.federating&&/*#__PURE__*/_jsx(Text,{theme:\"muted\",align:\"center\"},void 0,/*#__PURE__*/_jsx(FormattedMessage,{id:\"empty_column.home\",defaultMessage:\"Or you can visit {public} to get started and meet other users.\",values:{public:/*#__PURE__*/_jsx(Link,{to:\"/timeline/local\",className:\"text-primary-600 dark:text-primary-400 hover:underline\"},void 0,/*#__PURE__*/_jsx(FormattedMessage,{id:\"empty_column.home.local_tab\",defaultMessage:\"the {site_title} tab\",values:{site_title:siteTitle}}))}})))})));};export default HomeTimeline;"],"names":["messages","title","timelineId","intl","dispatch","features","polling","useRef","isPartial","state","_state$timelines$get","timelines","get","currentAccountId","_state$timelines$get2","feedAccountId","siteTitle","instance","currentAccountRelationship","relationships","handleLoadMore","useCallback","maxId","accountId","stopPolling","current","clearInterval","checkIfReloadNeeded","setInterval","handleRefresh","useEffect","following","label","formatMessage","transparent","withHeader","onRefresh","scrollKey","onLoadMore","divideType","showAds","emptyMessage","space","size","weight","align","id","defaultMessage","theme","values","federating","public","to","className","site_title"],"sourceRoot":""}