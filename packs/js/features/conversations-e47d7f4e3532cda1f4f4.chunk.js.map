{"version":3,"file":"packs/js/features/conversations-e47d7f4e3532cda1f4f4.chunk.js","mappings":"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","sources":["webpack://mangane-fe/./app/soapbox/components/account_search.tsx","webpack://mangane-fe/./app/soapbox/features/conversations/components/conversation.tsx","webpack://mangane-fe/./app/soapbox/features/conversations/components/conversations_list.tsx","webpack://mangane-fe/./app/soapbox/features/conversations/index.tsx"],"sourcesContent":["import _extends from\"@babel/runtime/helpers/esm/extends\";import _jsx from\"@babel/runtime/helpers/esm/jsx\";import _objectWithoutProperties from\"@babel/runtime/helpers/esm/objectWithoutProperties\";const _excluded=[\"onSelected\"];import\"core-js/modules/web.dom-collections.iterator.js\";import classNames from'classnames';import React,{useState}from'react';import{defineMessages,useIntl}from'react-intl';import AutosuggestAccountInput from'soapbox/components/autosuggest_account_input';import Icon from'soapbox/components/icon';const messages=defineMessages({placeholder:{\"id\":\"account_search.placeholder\",\"defaultMessage\":\"Search for an account\"}});/** Input to search for accounts. */const AccountSearch=_ref=>{let{onSelected}=_ref,rest=_objectWithoutProperties(_ref,_excluded);const intl=useIntl();const[value,setValue]=useState('');const isEmpty=()=>{return!(value.length>0);};const clearState=()=>{setValue('');};const handleChange=_ref2=>{let{target}=_ref2;setValue(target.value);};const handleSelected=accountId=>{clearState();onSelected(accountId);};const handleClear=e=>{e.preventDefault();if(!isEmpty()){setValue('');}};const handleKeyDown=e=>{if(e.key==='Escape'){var _document$querySelect,_document$querySelect2;(_document$querySelect=document.querySelector('.ui'))===null||_document$querySelect===void 0?void 0:(_document$querySelect2=_document$querySelect.parentElement)===null||_document$querySelect2===void 0?void 0:_document$querySelect2.focus();}};return/*#__PURE__*/_jsx(\"div\",{className:\"search search--account\"},void 0,/*#__PURE__*/_jsx(\"label\",{},void 0,/*#__PURE__*/_jsx(\"span\",{style:{display:'none'}},void 0,intl.formatMessage(messages.placeholder)),/*#__PURE__*/React.createElement(AutosuggestAccountInput,_extends({className:\"rounded-full\",placeholder:intl.formatMessage(messages.placeholder),value:value,onChange:handleChange,onSelected:handleSelected,onKeyDown:handleKeyDown},rest))),/*#__PURE__*/_jsx(\"div\",{role:\"button\",tabIndex:0,className:\"search__icon\",onClick:handleClear},void 0,/*#__PURE__*/_jsx(Icon,{src:require('@tabler/icons/search.svg'),className:classNames('svg-icon--search',{active:isEmpty()})}),/*#__PURE__*/_jsx(Icon,{src:require('@tabler/icons/backspace.svg'),className:classNames('svg-icon--backspace',{active:!isEmpty()}),\"aria-label\":intl.formatMessage(messages.placeholder)})));};export default AccountSearch;","import _jsx from\"@babel/runtime/helpers/esm/jsx\";import\"core-js/modules/es.string.replace.js\";import React,{useCallback,useMemo}from'react';import{HotKeys}from'react-hotkeys';import{useHistory}from'react-router-dom';import{markConversationRead}from'soapbox/actions/conversations';import Account from'soapbox/components/account';import{Icon}from'soapbox/components/ui';import{useAppDispatch,useAppSelector}from'soapbox/hooks';const Conversation=_ref=>{let{conversationId,onMoveUp,onMoveDown,className}=_ref;const dispatch=useAppDispatch();const history=useHistory();const{accounts,unread,lastStatusId,lastStatus}=useAppSelector(state=>{const conversation=state.conversations.items.find(x=>x.id===conversationId);return{accounts:conversation.accounts.map(accountId=>state.accounts.get(accountId,null)),unread:conversation.unread,lastStatus:state.statuses.get(conversation.last_status,null),lastStatusId:conversation.last_status||null};});const handleClick=useCallback(()=>{if(unread){dispatch(markConversationRead(conversationId));}history.push(\"/statuses/\".concat(lastStatusId));},[conversationId,dispatch,history,lastStatusId,unread]);const handleHotkeyMoveUp=useCallback(()=>{onMoveUp(conversationId);},[conversationId,onMoveUp]);const handleHotkeyMoveDown=useCallback(()=>{onMoveDown(conversationId);},[conversationId,onMoveDown]);const handlers=useMemo(()=>{return{open:handleClick,moveUp:handleHotkeyMoveUp,moveDown:handleHotkeyMoveDown};},[handleClick,handleHotkeyMoveDown,handleHotkeyMoveUp]);if(lastStatusId===null){return null;}return/*#__PURE__*/_jsx(HotKeys,{handlers:handlers,\"data-testid\":\"status\"},void 0,/*#__PURE__*/_jsx(\"div\",{onClick:handleClick,role:\"button\",tabIndex:0,className:\"bg-white dark:bg-slate-800 px-4 py-6 sm:shadow-sm dark:shadow-inset sm:p-5 rounded-xl \".concat(className)},void 0,/*#__PURE__*/_jsx(\"div\",{className:\"flex justify-between gap-3\"},void 0,/*#__PURE__*/_jsx(\"div\",{className:\"flex gap-2 grow\"},void 0,accounts.map(a=>/*#__PURE__*/_jsx(Account,{withLinkToProfile:false,account:a}))),/*#__PURE__*/_jsx(Icon,{src:require('@tabler/icons/messages.svg'),count:unread?1:0,className:\"h-6 w-6 dark:group-hover:text-primary-500\"})),/*#__PURE__*/_jsx(\"div\",{className:\"flex justify-between mt-3 items-end gap-2\"},void 0,/*#__PURE__*/_jsx(\"div\",{style:{'whiteSpace':'nowrap'},className:\"overflow-x-hidden text-ellipsis text-gray-700 dark:text-gray-300\",dangerouslySetInnerHTML:{__html:lastStatus.contentHtml.replace(/<br ?\\/?>/g,' ')}}),/*#__PURE__*/_jsx(\"div\",{className:\"text-gray-300 dark:text-gray-300 text-xs\"},void 0,new Date(lastStatus.get('created_at')).toLocaleDateString(undefined,{day:'2-digit',month:'2-digit',year:'numeric'})))));};export default Conversation;","import _jsx from\"@babel/runtime/helpers/esm/jsx\";import debounce from'lodash/debounce';import React,{useRef}from'react';import{FormattedMessage}from'react-intl';import{expandConversations}from'soapbox/actions/conversations';import ScrollableList from'soapbox/components/scrollable_list';import{useAppDispatch,useAppSelector}from'soapbox/hooks';import Conversation from'../components/conversation';const ConversationsList=()=>{const dispatch=useAppDispatch();const ref=useRef(null);const conversations=useAppSelector(state=>state.conversations.items);const isLoading=useAppSelector(state=>state.conversations.isLoading);const getCurrentIndex=id=>conversations.findIndex(x=>x.id===id);const handleMoveUp=id=>{const elementIndex=getCurrentIndex(id)-1;selectChild(elementIndex);};const handleMoveDown=id=>{const elementIndex=getCurrentIndex(id)+1;selectChild(elementIndex);};const selectChild=index=>{var _ref$current;(_ref$current=ref.current)===null||_ref$current===void 0?void 0:_ref$current.scrollIntoView({index,behavior:'smooth',done:()=>{const element=document.querySelector(\"#direct-list [data-index=\\\"\".concat(index,\"\\\"] .focusable\"));if(element){element.focus();}}});};const handleLoadOlder=debounce(()=>{const maxId=conversations.getIn([-1,'id']);if(maxId)dispatch(expandConversations({maxId}));},300,{leading:true});return/*#__PURE__*/React.createElement(ScrollableList,{onLoadMore:handleLoadOlder,id:\"direct-list\",scrollKey:\"direct\",ref:ref,isLoading:isLoading,showLoading:isLoading,emptyMessage:/*#__PURE__*/_jsx(FormattedMessage,{id:\"empty_column.direct\",defaultMessage:\"You don't have any direct messages yet. When you send or receive one, it will show up here.\"})},conversations.map(item=>/*#__PURE__*/_jsx(Conversation,{className:\"my-3\",conversationId:item.id,onMoveUp:handleMoveUp,onMoveDown:handleMoveDown},item.id)));};export default ConversationsList;","import _jsx from\"@babel/runtime/helpers/esm/jsx\";import React,{useEffect}from'react';import{defineMessages,useIntl}from'react-intl';import{useHistory}from'react-router-dom';import{directComposeById}from'soapbox/actions/compose';import{mountConversations,unmountConversations,expandConversations}from'soapbox/actions/conversations';import{connectDirectStream}from'soapbox/actions/streaming';import AccountSearch from'soapbox/components/account_search';import SubNavigation from'soapbox/components/sub_navigation';import{Column}from'soapbox/components/ui';import{useAppDispatch}from'soapbox/hooks';import ConversationsList from'./components/conversations_list';const messages=defineMessages({title:{\"id\":\"column.direct\",\"defaultMessage\":\"Conversations\"},searchPlaceholder:{\"id\":\"direct.search_placeholder\",\"defaultMessage\":\"Send a message to\\u2026\"}});const ConversationsTimeline=()=>{const intl=useIntl();const dispatch=useAppDispatch();const history=useHistory();useEffect(()=>{dispatch(mountConversations());dispatch(expandConversations());const disconnect=dispatch(connectDirectStream());return()=>{dispatch(unmountConversations());disconnect();};},[dispatch]);const handleSuggestion=accountId=>{dispatch(directComposeById(history,accountId));};return/*#__PURE__*/_jsx(Column,{label:intl.formatMessage(messages.title),transparent:true,withHeader:false},void 0,/*#__PURE__*/_jsx(\"div\",{className:\"px-4 pt-4 pb-8 sm:px-0 sm:pt-0\"},void 0,/*#__PURE__*/_jsx(SubNavigation,{message:intl.formatMessage(messages.title)}),/*#__PURE__*/_jsx(\"div\",{className:\"flex flex-col gap-3\"},void 0,/*#__PURE__*/_jsx(AccountSearch,{placeholder:intl.formatMessage(messages.searchPlaceholder),onSelected:handleSuggestion}),/*#__PURE__*/_jsx(ConversationsList,{}))));};export default ConversationsTimeline;"],"names":["_excluded","messages","placeholder","_ref","onSelected","rest","intl","useIntl","useState","value","setValue","isEmpty","length","className","style","display","formatMessage","onChange","_ref2","target","accountId","onKeyDown","e","_document$querySelect","_document$querySelect2","key","document","querySelector","parentElement","focus","role","tabIndex","onClick","preventDefault","src","active","conversationId","onMoveUp","onMoveDown","dispatch","history","state","conversation","conversations","items","find","x","id","accounts","map","get","unread","lastStatus","statuses","last_status","lastStatusId","handleClick","useCallback","push","concat","handleHotkeyMoveUp","handleHotkeyMoveDown","handlers","useMemo","open","moveUp","moveDown","HotKeys","a","withLinkToProfile","account","count","dangerouslySetInnerHTML","__html","contentHtml","replace","Date","toLocaleDateString","undefined","day","month","year","ref","useRef","isLoading","getCurrentIndex","findIndex","handleMoveUp","elementIndex","selectChild","handleMoveDown","index","_ref$current","current","scrollIntoView","behavior","done","element","handleLoadOlder","maxId","getIn","leading","onLoadMore","scrollKey","showLoading","emptyMessage","defaultMessage","item","title","searchPlaceholder","useEffect","disconnect","label","transparent","withHeader","message"],"sourceRoot":""}