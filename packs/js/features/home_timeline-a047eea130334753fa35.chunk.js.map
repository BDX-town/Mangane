{"version":3,"file":"packs/js/features/home_timeline-a047eea130334753fa35.chunk.js","mappings":"wOAA2qBA,GAAS,QAAe,CAACC,MAAM,CAAC,GAAK,cAAc,eAAiB,UAKmzB,UALtxB,WAAK,IAAMC,GAAK,SAAgBC,GAAS,UAAuBC,GAAS,UAAoBC,GAAQ,IAAAC,QAAO,MAAYC,GAAU,SAAe,SAAAC,GAAQ,IAAIC,EAAqB,OAAyI,KAA7E,QAApDA,EAAqBD,EAAME,UAAUC,IAAI,eAAwC,IAAvBF,OAA8B,EAAOA,EAAqBF,cAA2BK,GAAiB,SAAe,SAAAJ,GAAQ,IAAIK,EAAsB,OAA4D,QAArDA,EAAsBL,EAAME,UAAUC,IAAI,eAAyC,IAAxBE,OAA+B,EAAOA,EAAsBC,iBAAuBC,GAAU,SAAe,SAAAP,GAAO,OAAAA,EAAMQ,SAASf,SAAagB,GAA2B,SAAe,SAAAT,GAAO,OAAAI,EAAiBJ,EAAMU,cAAcP,IAAIC,GAAkB,QAEl0CO,EAAY,WAAQd,EAAQe,UAASC,cAAchB,EAAQe,SAASf,EAAQe,QAAQ,OAGgD,OAHgE,IAAAE,YAAU,WAA2B,OAAzVf,EAAWF,EAAQe,QAAQG,aAAY,WAAKpB,GAAS,aAAwB,KAAYgB,IAAsQ,WAAKA,OAAkB,CAACZ,KAAY,IAAAe,YAAU,WAC5aV,GAAkBT,GAAS,SAAmB,CAACS,OAAuB,KAAI,IAAAU,YAAU,YAEpFL,GAA8BA,MAAAA,GAAwEA,EAA2BO,YAAYrB,GAAS,WAAsBA,GAAS,QAAmB,IAAG,WAAKA,GAAS,kBAAsC,CAACS,KAAsC,OAAK,KAAO,CAACa,MAAMvB,EAAKwB,cAAc1B,EAASC,OAAO0B,aAAY,EAAKC,YAAW,QAAO,GAAoB,OAAK,IAAc,CAACC,UAHxK,WAAK,OAAO1B,GAAS,QAAmB,CAAC2B,MAAM,KAAKC,UAAUnB,YAGmI,GAAoB,OAAK,IAAS,CAACoB,UAAU,gBAAgBC,WAL++B,SAAAH,GAAQ3B,GAAS,QAAmB,CAAC2B,MAAK,EAACC,UAAUnB,MAK1gCsB,WAAW,OAAOC,WAAW,QAAQC,SAAQ,EAAKC,cAA0B,OAAK,KAAM,CAACC,MAAM,QAAG,GAAoB,OAAK,KAAK,CAACC,KAAK,KAAKC,OAAO,SAASC,MAAM,eAAU,GAAoB,OAAK,IAAiB,CAACC,GAAG,0BAA0BC,eAAe,sCAAkD,OAAK,KAAK,CAACC,MAAM,QAAQH,MAAM,eAAU,GAAoB,OAAK,IAAiB,CAACC,GAAG,6BAA6BC,eAAe,iEAAiEE,OAAO,CAAC9B,UAAS,MAAKX,EAAS0C,aAAyB,OAAK,KAAK,CAACF,MAAM,QAAQH,MAAM,eAAU,GAAoB,OAAK,IAAiB,CAACC,GAAG,oBAAoBC,eAAe,iEAAiEE,OAAO,CAACE,QAAoB,OAAK,KAAK,CAACC,GAAG,kBAAkBC,UAAU,+DAA0D,GAAoB,OAAK,IAAiB,CAACP,GAAG,8BAA8BC,eAAe,uBAAuBE,OAAO,CAACK,WAAWnC","sources":["webpack://mangane-fe/./app/soapbox/features/home_timeline/index.tsx"],"sourcesContent":["import _jsx from\"@babel/runtime/helpers/esm/jsx\";import React,{useEffect,useRef}from'react';import{defineMessages,useIntl,FormattedMessage}from'react-intl';import{Link}from'react-router-dom';import{fetchRelationships}from'soapbox/actions/accounts';import{fetchSuggestionsForTimeline}from'soapbox/actions/suggestions';import{expandHomeTimeline}from'soapbox/actions/timelines';import PullToRefresh from'soapbox/components/pull-to-refresh';import{Column,Stack,Text}from'soapbox/components/ui';import Timeline from'soapbox/features/ui/components/timeline';import{useAppSelector,useAppDispatch,useFeatures}from'soapbox/hooks';import{clearFeedAccountId}from'../../actions/timelines';const messages=defineMessages({title:{\"id\":\"column.home\",\"defaultMessage\":\"Home\"}});const HomeTimeline=()=>{const intl=useIntl();const dispatch=useAppDispatch();const features=useFeatures();const polling=useRef(null);const isPartial=useAppSelector(state=>{var _state$timelines$get;return((_state$timelines$get=state.timelines.get('home'))===null||_state$timelines$get===void 0?void 0:_state$timelines$get.isPartial)===true;});const currentAccountId=useAppSelector(state=>{var _state$timelines$get2;return(_state$timelines$get2=state.timelines.get('home'))===null||_state$timelines$get2===void 0?void 0:_state$timelines$get2.feedAccountId;});const siteTitle=useAppSelector(state=>state.instance.title);const currentAccountRelationship=useAppSelector(state=>currentAccountId?state.relationships.get(currentAccountId):null);const handleLoadMore=maxId=>{dispatch(expandHomeTimeline({maxId,accountId:currentAccountId}));};// Mastodon generates the feed in Redis, and can return a partial timeline\n// (HTTP 206) for new users. Poll until we get a full page of results.\nconst checkIfReloadNeeded=()=>{if(isPartial){polling.current=setInterval(()=>{dispatch(expandHomeTimeline());},3000);}else{stopPolling();}};const stopPolling=()=>{if(polling.current){clearInterval(polling.current);polling.current=null;}};const handleRefresh=()=>{return dispatch(expandHomeTimeline({maxId:null,accountId:currentAccountId}));};useEffect(()=>{checkIfReloadNeeded();return()=>{stopPolling();};},[isPartial]);useEffect(()=>{// Check to see if we still follow the user that is selected in the Feed Carousel.\nif(currentAccountId){dispatch(fetchRelationships([currentAccountId]));}},[]);useEffect(()=>{// If we unfollowed the currently selected user from the Feed Carousel,\n// let's clear the feed filter and refetch fresh timeline data.\nif(currentAccountRelationship&&!(currentAccountRelationship!==null&&currentAccountRelationship!==void 0&&currentAccountRelationship.following)){dispatch(clearFeedAccountId());dispatch(expandHomeTimeline({},()=>{dispatch(fetchSuggestionsForTimeline());}));}},[currentAccountId]);return/*#__PURE__*/_jsx(Column,{label:intl.formatMessage(messages.title),transparent:true,withHeader:false},void 0,/*#__PURE__*/_jsx(PullToRefresh,{onRefresh:handleRefresh},void 0,/*#__PURE__*/_jsx(Timeline,{scrollKey:\"home_timeline\",onLoadMore:handleLoadMore,timelineId:\"home\",divideType:\"space\",showAds:true,emptyMessage:/*#__PURE__*/_jsx(Stack,{space:1},void 0,/*#__PURE__*/_jsx(Text,{size:\"xl\",weight:\"medium\",align:\"center\"},void 0,/*#__PURE__*/_jsx(FormattedMessage,{id:\"empty_column.home.title\",defaultMessage:\"You're not following anyone yet\"})),/*#__PURE__*/_jsx(Text,{theme:\"muted\",align:\"center\"},void 0,/*#__PURE__*/_jsx(FormattedMessage,{id:\"empty_column.home.subtitle\",defaultMessage:\"{siteTitle} gets more interesting once you follow other users.\",values:{siteTitle}})),features.federating&&/*#__PURE__*/_jsx(Text,{theme:\"muted\",align:\"center\"},void 0,/*#__PURE__*/_jsx(FormattedMessage,{id:\"empty_column.home\",defaultMessage:\"Or you can visit {public} to get started and meet other users.\",values:{public:/*#__PURE__*/_jsx(Link,{to:\"/timeline/local\",className:\"text-primary-600 dark:text-primary-400 hover:underline\"},void 0,/*#__PURE__*/_jsx(FormattedMessage,{id:\"empty_column.home.local_tab\",defaultMessage:\"the {site_title} tab\",values:{site_title:siteTitle}}))}})))})));};export default HomeTimeline;"],"names":["messages","title","intl","dispatch","features","polling","useRef","isPartial","state","_state$timelines$get","timelines","get","currentAccountId","_state$timelines$get2","feedAccountId","siteTitle","instance","currentAccountRelationship","relationships","stopPolling","current","clearInterval","useEffect","setInterval","following","label","formatMessage","transparent","withHeader","onRefresh","maxId","accountId","scrollKey","onLoadMore","timelineId","divideType","showAds","emptyMessage","space","size","weight","align","id","defaultMessage","theme","values","federating","public","to","className","site_title"],"sourceRoot":""}