"use strict";(self.webpackChunkmangane_fe=self.webpackChunkmangane_fe||[]).push([[206],{1108:function(e,t,a){a.r(t),a.d(t,{default:function(){return S}});var i,n,l,r,o,s=a(1841),p=a(1827),g=a(1812),h=(a(1),a(5)),d=a.n(h),c=a(448),u=a(0),x=a(1813),m=a(1815),f=a(1843),v=a(6),y=a(17),w=a(192),b=a(14),_=a(93),Z=a(898),M=a(494),$=a(47),k=a(1859),N=a(2),C=(i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])},i(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function a(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(a.prototype=t.prototype,new a)}),P=(0,x.vU)({toggle_visible:{id:"media_gallery.toggle_visible",defaultMessage:"Hide"}}),z=(0,v.$j)((function(e){return{autoPlayGif:(0,y.Gw)(e).get("autoPlayGif")}}))((l=function(e){function t(){var t=e.apply(this,arguments)||this;return(0,g.Z)(t,"state",{loaded:!1}),(0,g.Z)(t,"handleMouseEnter",(function(e){t.hoverToPlay()&&e.target.play()})),(0,g.Z)(t,"handleMouseLeave",(function(e){t.hoverToPlay()&&(e.target.pause(),e.target.currentTime=0)})),(0,g.Z)(t,"handleClick",(function(e){var a=t.props,i=a.index,n=a.onClick;(0,$.gn)()&&!e.target.autoPlay?(e.target.autoPlay=!0,e.preventDefault()):0!==e.button||e.ctrlKey||e.metaKey||(t.hoverToPlay()&&(e.target.pause(),e.target.currentTime=0),e.preventDefault(),n(i)),e.stopPropagation()})),(0,g.Z)(t,"handleImageLoad",(function(){t.setState({loaded:!0})})),(0,g.Z)(t,"handleVideoHover",(function(e){var t=e.target;t.playbackRate=3,t.play()})),(0,g.Z)(t,"handleVideoLeave",(function(e){var t=e.target;t.pause(),t.currentTime=0})),t}return C(t,e),t.prototype.hoverToPlay=function(){var e=this.props,t=e.attachment;return!e.autoPlayGif&&"gifv"===t.get("type")},t.prototype.render=function(){var e=this.props,t=e.attachment,i=e.standalone,n=e.visible,l=e.dimensions,r=e.autoPlayGif,o=e.last,g=e.total,h=100,c="100%",x="auto",m="auto",f="auto",v="auto",y="left",N="relative";l&&(h=l.w,c=l.h,x=l.t||"auto",v=l.r||"auto",f=l.b||"auto",m=l.l||"auto",y=l.float||"left",N=l.pos||"relative");var C="";if("unknown"===t.get("type")){var P=(0,M.TF)(t.get("remote_url"),45),z=(0,p.Z)(b.Z,{className:"h-16 w-16 text-gray-800 dark:text-gray-200",src:Z.Z[t.getIn(["pleroma","mime_type"])]||a(441)});return(0,p.Z)("div",{className:d()("media-gallery__item",{standalone:i}),style:{position:N,float:y,left:m,top:x,right:v,bottom:f,height:c,width:"".concat(h,"%")}},t.get("id"),(0,p.Z)("a",{className:"media-gallery__item-thumbnail",href:t.get("remote_url"),target:"_blank",style:{cursor:"pointer"}},void 0,(0,p.Z)(w.Z,{hash:t.get("blurhash"),className:"media-gallery__preview"}),(0,p.Z)("span",{className:"media-gallery__item__icons"},void 0,z),(0,p.Z)("span",{className:"media-gallery__filename__label"},void 0,P)))}if("image"===t.get("type")){var S=t.get("url"),D=function(e){var t=e.getIn(["meta","original","aspect"]);return!t||!function(e){return e>=k.Mr&&e<=k.q3}(t)}(t);C=(0,p.Z)("a",{className:d()("media-gallery__item-thumbnail",{letterboxed:D}),href:t.get("remote_url")||S,onClick:this.handleClick,target:"_blank"},void 0,(0,p.Z)(_.Z,{src:S,alt:t.get("description")}))}else if("gifv"===t.get("type")){var T={};(0,$.gn)()&&(T.playsInline="1"),r&&(T.autoPlay="1"),C=(0,p.Z)("div",{className:d()("media-gallery__gifv",{autoplay:r})},void 0,u.createElement("video",(0,s.Z)({className:"media-gallery__item-gifv-thumbnail","aria-label":t.get("description"),title:t.get("description"),role:"application",src:t.get("url"),onClick:this.handleClick,onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave,loop:!0,muted:!0},T)),(0,p.Z)("span",{className:"media-gallery__gifv__label"},void 0,"GIF"))}else if("audio"===t.get("type")){var O=t.get("url").split(".").pop().toUpperCase();C=(0,p.Z)("a",{className:d()("media-gallery__item-thumbnail"),href:t.get("url"),onClick:this.handleClick,target:"_blank",alt:t.get("description"),title:t.get("description")},void 0,(0,p.Z)("span",{className:"media-gallery__item__icons"},void 0,(0,p.Z)(b.Z,{src:a(452)})),(0,p.Z)("span",{className:"media-gallery__file-extension__label"},void 0,O))}else"video"===t.get("type")&&(O=t.get("url").split(".").pop().toUpperCase(),C=(0,p.Z)("a",{className:d()("media-gallery__item-thumbnail"),href:t.get("url"),onClick:this.handleClick,target:"_blank",alt:t.get("description"),title:t.get("description")},void 0,(0,p.Z)("video",{muted:!0,loop:!0,onMouseOver:this.handleVideoHover,onMouseOut:this.handleVideoLeave},void 0,(0,p.Z)("source",{src:t.get("url")})),(0,p.Z)("span",{className:"media-gallery__file-extension__label"},void 0,O)));return(0,p.Z)("div",{className:d()("media-gallery__item","media-gallery__item--".concat(t.get("type")),{standalone:i}),style:{position:N,float:y,left:m,top:x,right:v,bottom:f,height:c,width:"".concat(h,"%")}},t.get("id"),o&&g>4&&(0,p.Z)("div",{className:"media-gallery__item-overflow"},void 0,"+",g-4+1),(0,p.Z)(w.Z,{hash:t.get("blurhash"),className:d()("media-gallery__preview",{"media-gallery__preview--hidden":n&&this.state.loaded})}),n&&C)},t}(u.PureComponent),(0,g.Z)(l,"defaultProps",{standalone:!1,index:0,size:1}),n=l))||n,S=(0,v.$j)((function(e){return{displayMedia:(0,y.Gw)(e).get("displayMedia")}}))(r=(0,m.ZP)((o=function(e){function t(){var t=e.apply(this,arguments)||this;return(0,g.Z)(t,"state",{visible:void 0!==t.props.visible?t.props.visible:"hide_all"!==t.props.displayMedia&&!t.props.sensitive||"show_all"===t.props.displayMedia,width:t.props.defaultWidth}),(0,g.Z)(t,"handleOpen",(function(e){e.stopPropagation(),t.props.onToggleVisibility?t.props.onToggleVisibility():t.setState({visible:!t.state.visible})})),(0,g.Z)(t,"handleClick",(function(e){t.props.onOpenMedia(t.props.media,e)})),(0,g.Z)(t,"handleRef",(function(e){e&&(t.props.cacheWidth&&t.props.cacheWidth(e.offsetWidth),t.setState({width:e.offsetWidth}))})),(0,g.Z)(t,"getSizeDataSingle",(function(){var e=t.props,a=e.media,i=e.defaultWidth,n=t.state.width||i,l=a.getIn([0,"meta","original","aspect"]);return(0,c.Map)({style:{height:l?(0,k.gn)(l)?Math.floor(n/k.q3):(0,k.gr)(l)?Math.floor(n/k.Mr):Math.floor(n/l):9*n/16},itemsDimensions:[],size:1,width:n})})),(0,g.Z)(t,"getSizeDataMultiple",(function(e){var a=t.props,i=a.media,n=a.defaultWidth,l=t.state.width||n,r=Math.floor(l/k.q3),o="".concat(Math.floor(l/k.q3),"px"),s={},p=[],g=Array(e).fill().map((function(e,t){return i.getIn([t,"meta","original","aspect"])})),h=g[0],d=g[1],u=g[2],x=g[3];return 2===e?((0,k.gr)(h)&&(0,k.gr)(d)?s.height=l-l/k.q3:(0,k.gn)(h)&&(0,k.gn)(d)?s.height=2*r:(0,k.gn)(h)&&(0,k.gr)(d)||(0,k.gr)(h)&&(0,k.gn)(d)||(0,k.gn)(h)&&(0,k.x$)(d)||(0,k.x$)(h)&&(0,k.gn)(d)?s.height=.6*l+l/k.q3:s.height=l/2,p=(0,k.gr)(h)&&(0,k.gr)(d)?[{w:50,h:"100%",r:"2px"},{w:50,h:"100%",l:"2px"}]:(0,k.gn)(h)&&(0,k.gn)(d)?[{w:100,h:o,b:"2px"},{w:100,h:o,t:"2px"}]:(0,k.gn)(h)&&(0,k.gr)(d)||(0,k.gn)(h)&&(0,k.x$)(d)?[{w:100,h:"".concat(l/k.q3,"px"),b:"2px"},{w:100,h:"".concat(.6*l,"px"),t:"2px"}]:(0,k.gr)(h)&&(0,k.gn)(d)||(0,k.x$)(h)&&(0,k.gn)(d)?[{w:100,h:"".concat(.6*l,"px"),b:"2px"},{w:100,h:"".concat(l/k.q3,"px"),t:"2px"}]:[{w:50,h:"100%",r:"2px"},{w:50,h:"100%",l:"2px"}]):3===e?((0,k.gn)(h)&&(0,k.gn)(d)&&(0,k.gn)(u)?s.height=3*r:(0,k.gr)(h)&&(0,k.gr)(d)&&(0,k.gr)(u)?s.height=Math.floor(l/k.Mr):s.height=l,p=(0,k.gn)(h)&&(0,k.x$)(d)&&(0,k.x$)(u)?[{w:100,h:"50%",b:"2px"},{w:50,h:"50%",t:"2px",r:"2px"},{w:50,h:"50%",t:"2px",l:"2px"}]:(0,k.gn)(h)&&(0,k.gn)(d)&&(0,k.gn)(u)?[{w:100,h:o,b:"4px"},{w:100,h:o},{w:100,h:o,t:"4px"}]:(0,k.gr)(h)&&(0,k.x$)(d)&&(0,k.x$)(u)?[{w:50,h:"100%",r:"2px"},{w:50,h:"50%",b:"2px",l:"2px"},{w:50,h:"50%",t:"2px",l:"2px"}]:(0,k.x$)(h)&&(0,k.x$)(d)&&(0,k.gr)(u)?[{w:50,h:"50%",b:"2px",r:"2px"},{w:50,h:"50%",l:"-2px",b:"-2px",pos:"absolute",float:"none"},{w:50,h:"100%",r:"-2px",t:"0px",b:"0px",pos:"absolute",float:"none"}]:(0,k.x$)(h)&&(0,k.gr)(d)&&(0,k.x$)(u)||(0,k.gr)(h)&&(0,k.gr)(d)&&(0,k.gr)(u)?[{w:50,h:"50%",b:"2px",r:"2px"},{w:50,h:"100%",l:"2px",float:"right"},{w:50,h:"50%",t:"2px",r:"2px"}]:(0,k.gn)(h)&&(0,k.gn)(d)&&(0,k.x$)(u)||(0,k.gn)(h)&&(0,k.gn)(d)&&(0,k.gr)(u)?[{w:50,h:o,b:"2px",r:"2px"},{w:50,h:o,b:"2px",l:"2px"},{w:100,h:"".concat(l-r,"px"),t:"2px"}]:(0,k.x$)(h)&&(0,k.gn)(d)&&(0,k.gn)(u)||(0,k.gr)(h)&&(0,k.gn)(d)&&(0,k.gn)(u)?[{w:100,h:"".concat(l-r,"px"),b:"2px"},{w:50,h:o,t:"2px",r:"2px"},{w:50,h:o,t:"2px",l:"2px"}]:[{w:50,h:"50%",b:"2px",r:"2px"},{w:50,h:"50%",b:"2px",l:"2px"},{w:100,h:"50%",t:"2px"}]):e>=4&&((0,k.gr)(h)&&(0,k.gr)(d)&&(0,k.gr)(u)&&(0,k.gr)(x)||(0,k.gr)(h)&&(0,k.gr)(d)&&(0,k.gr)(u)&&(0,k.x$)(x)||(0,k.gr)(h)&&(0,k.gr)(d)&&(0,k.x$)(u)&&(0,k.gr)(x)||(0,k.gr)(h)&&(0,k.x$)(d)&&(0,k.gr)(u)&&(0,k.gr)(x)||(0,k.x$)(h)&&(0,k.gr)(d)&&(0,k.gr)(u)&&(0,k.gr)(x)?s.height=Math.floor(l/k.Mr):(0,k.gn)(h)&&(0,k.gn)(d)&&(0,k.gn)(u)&&(0,k.gn)(x)?s.height=2*r:(0,k.gn)(h)&&(0,k.gn)(d)&&(0,k.x$)(u)&&(0,k.x$)(x)||(0,k.x$)(h)&&(0,k.x$)(d)&&(0,k.gn)(u)&&(0,k.gn)(x)?s.height=r+l/2:s.height=l,p=(0,k.gn)(h)&&(0,k.gn)(d)&&(0,k.x$)(u)&&(0,k.x$)(x)?[{w:50,h:o,b:"2px",r:"2px"},{w:50,h:o,b:"2px",l:"2px"},{w:50,h:"".concat(l/2,"px"),t:"2px",r:"2px"},{w:50,h:"".concat(l/2,"px"),t:"2px",l:"2px"}]:(0,k.x$)(h)&&(0,k.x$)(d)&&(0,k.gn)(u)&&(0,k.gn)(x)?[{w:50,h:"".concat(l/2,"px"),b:"2px",r:"2px"},{w:50,h:"".concat(l/2,"px"),b:"2px",l:"2px"},{w:50,h:o,t:"2px",r:"2px"},{w:50,h:o,t:"2px",l:"2px"}]:(0,k.gr)(h)&&(0,k.x$)(d)&&(0,k.x$)(u)&&(0,k.x$)(x)||(0,k.gr)(h)&&(0,k.gn)(d)&&(0,k.gn)(u)&&(0,k.gn)(x)?[{w:67,h:"100%",r:"2px"},{w:33,h:"33%",b:"4px",l:"2px"},{w:33,h:"33%",l:"2px"},{w:33,h:"33%",t:"4px",l:"2px"}]:[{w:50,h:"50%",b:"2px",r:"2px"},{w:50,h:"50%",b:"2px",l:"2px"},{w:50,h:"50%",t:"2px",r:"2px"},{w:50,h:"50%",t:"2px",l:"2px"}]),(0,c.Map)({style:s,itemsDimensions:p,size:e,width:l})})),(0,g.Z)(t,"getSizeData",(function(e){var a=t.props,i=a.height,n=a.defaultWidth,l=t.state.width||n;if(l){if(1===e)return t.getSizeDataSingle();if(e>1)return t.getSizeDataMultiple(e)}return(0,c.Map)({style:{height:i},itemsDimensions:[],size:e,width:l})})),t}return C(t,e),t.prototype.componentDidUpdate=function(e){var t=this.props,a=t.media,i=t.visible,n=t.sensitive;(0,c.is)(a,e.media)||void 0!==i?(0,c.is)(i,e.visible)||void 0===i||this.setState({visible:i}):this.setState({visible:"hide_all"!==e.displayMedia&&!n||"show_all"===e.displayMedia})},t.prototype.render=function(){var e,t=this,i=this.props,n=i.media,l=i.intl,r=i.sensitive,o=i.compact,s=this.state.visible,g=this.getSizeData(n.size),h=n.take(4).map((function(e,a){return(0,p.Z)(z,{onClick:t.handleClick,attachment:e,index:a,size:g.get("size"),displayWidth:g.get("width"),visible:s,dimensions:g.get("itemsDimensions")[a],last:3===a,total:n.size},e.get("id"))}));return e=r?(0,p.Z)(f.Z,{id:"status.sensitive_warning",defaultMessage:"Sensitive content"}):(0,p.Z)(f.Z,{id:"status.media_hidden",defaultMessage:"Media hidden"}),u.createElement("div",{className:d()("media-gallery",{"media-gallery--compact":o}),style:g.get("style"),ref:this.handleRef},(0,p.Z)("div",{className:d()("spoiler-button",{"spoiler-button--minified":s||o})},void 0,s||o?(0,p.Z)(N.zx,{text:l.formatMessage(P.toggle_visible),icon:a(s?94:465),onClick:this.handleOpen,theme:"transparent",size:"sm"}):(0,p.Z)("button",{type:"button",onClick:this.handleOpen,className:"bg-transparent w-full h-full border-0"},void 0,(0,p.Z)("div",{className:"p-4 rounded-xl shadow-xl backdrop-blur-sm bg-white/75 dark:bg-slate-800/75 text-center inline-block space-y-4 max-w-[280px]"},void 0,(0,p.Z)("div",{className:"space-y-1"},void 0,(0,p.Z)(N.xv,{weight:"semibold"},void 0,e),r&&(0,p.Z)(N.xv,{size:"sm"},void 0,(0,p.Z)(f.Z,{id:"status.sensitive_warning.subtitle",defaultMessage:"This content may not be suitable for all audiences."}))),(0,p.Z)(N.zx,{type:"button",theme:"primary",size:"sm",icon:a(465)},void 0,(0,p.Z)(f.Z,{id:"status.sensitive_warning.action",defaultMessage:"Show content"}))))),h)},t}(u.PureComponent),(0,g.Z)(o,"defaultProps",{standalone:!1}),r=o))||r)||r}}]);
//# sourceMappingURL=media_gallery-ee7cbf597154e4488c08.chunk.js.map